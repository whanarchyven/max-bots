# Max Bot - Telegram Bot для B2B партнерства

Телеграм-бот для привлечения партнеров в B2B-бизнес на ИИ-агентах с использованием Convex в качестве бэкенда.

## Возможности

- ✅ Полное сохранение всех переписок с пользователями
- ✅ Отдельная коллекция для лидов
- ✅ Система навигации по всем разделам из ТЗ
- ✅ Запись на звонки с уведомлениями
- ✅ Квалификация лидов
- ✅ FAQ система
- ✅ Адаптивные диалоги для новичков

## Структура базы данных

### Таблицы:
- `conversations` - все переписки с пользователями
- `messages` - история сообщений
- `leads` - лиды с полной информацией
- `callBookings` - записи на звонки

## Установка и настройка

### 1. Установка зависимостей
```bash
bun install
```

### 2. Настройка Convex
```bash
# Инициализация Convex (если еще не сделано)
bunx convex dev

# Деплой схемы базы данных
bunx convex deploy
```

### 3. Настройка переменных окружения
Скопируйте `env.example` в `.env` и заполните:

```bash
cp env.example .env
```

Заполните переменные:
- `TELEGRAM_BOT_TOKEN` - токен бота от @BotFather
- `CONVEX_URL` - URL вашего Convex проекта

### 4. Создание Telegram ботов
1. **Основной бот** - напишите @BotFather, создайте бота для пользователей
2. **Бот уведомлений** - создайте второго бота для администраторов
3. Скопируйте токены в `.env`

### 5. Настройка администраторов
1. Узнайте свой Telegram ID (напишите @userinfobot)
2. Добавьте ID в `ADMIN_CHAT_IDS` в `.env` (через запятую для нескольких)

### 6. Запуск ботов
```bash
# Основной бот
bun run start

# Бот уведомлений (в отдельном терминале)
bun run start:notifications
```

## Структура проекта

```
├── convex/
│   ├── schema.ts          # Схема базы данных
│   ├── conversations.ts   # Функции для переписок
│   ├── leads.ts          # Функции для лидов
│   └── callBookings.ts   # Функции для записи звонков
├── index.ts              # Основной файл бота
├── package.json
└── README.md
```

## Сценарии диалогов

### Основной поток:
1. **Приветствие** - первое сообщение с кнопками
2. **Хочу детали** - переход к основному меню
3. **Как это работает** - описание процесса
4. **Финмодель** - примеры цифр
5. **Вложения** - стоимость входа
6. **Роли** - что от нас/от тебя
7. **Квалификация** - проверка готовности
8. **Запись на звонок** - форма и подтверждение

### Дополнительные сценарии:
- **FAQ** - часто задаваемые вопросы
- **Я начинающий** - адаптивный диалог для новичков
- **Перенос/отмена звонков**

## API функции

### Conversations
- `upsertConversation` - создание/обновление переписки
- `getConversation` - получение переписки
- `updateConversationStep` - обновление шага диалога
- `addMessage` - добавление сообщения
- `getMessages` - получение истории сообщений

### Leads
- `upsertLead` - создание/обновление лида
- `getLead` - получение лида
- `updateLeadStatus` - обновление статуса
- `updateLeadQualification` - обновление квалификации
- `getAllLeads` - получение всех лидов
- `getLeadsStats` - статистика лидов

### Call Bookings
- `createCallBooking` - создание записи на звонок
- `updateCallBooking` - обновление записи
- `getCallBooking` - получение записи
- `getUpcomingCalls` - предстоящие звонки
- `cancelCallBooking` - отмена записи

## Мониторинг

Все данные сохраняются в Convex и доступны через:
- Dashboard Convex для просмотра данных
- API функции для получения статистики
- Логи в консоли приложения

## Развертывание

1. Деплой Convex: `bunx convex deploy`
2. Настройка переменных окружения на сервере
3. Запуск бота: `bun run index.ts`

## Поддержка

При возникновении проблем проверьте:
1. Правильность токена бота
2. Доступность Convex URL
3. Логи в консоли
4. Статус Convex деплоя# max-bots
